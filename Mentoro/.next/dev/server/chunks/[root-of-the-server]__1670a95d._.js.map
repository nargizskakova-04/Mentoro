{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/dilyarabaizova/Mentoro/Mentoro/src/app/api/quizzes/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(request: NextRequest) {\n    try {\n        const body = await request.json();\n        const { type, documentText } = body;\n\n        // Используй тот же ключ, что и в чате\n        const API_KEY = process.env.GOOGLE_AI_API_KEY;  \n\n        if (!documentText) {\n            return NextResponse.json({ error: 'No text provided' }, { status: 400 });\n        }\n\n        let prompt = \"\";\n        if (type === 'explain') {\n            prompt = `Explain these study materials clearly in Markdown. Text: ${documentText}`;\n        } else {\n            prompt = `Create a quiz from this text. Return ONLY a JSON array. \n            Format: [{\"question\": \"...\", \"options\": [\"a\", \"b\", \"c\", \"d\"], \"correctAnswer\": \"...\", \"explanation\": \"...\"}]\n            Text: ${documentText}`;\n        }\n\n        // Добавляем ту самую строку URL, которой не хватало:\n        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent?key=${API_KEY}`;\n\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                contents: [{ parts: [{ text: prompt }] }]\n            })\n        });\n\n        const data = await response.json();\n\n        if (!response.ok) {\n            console.error(\"GENERATION ERROR:\", data);\n            return NextResponse.json(data, { status: response.status });\n        }\n\n        let botText = data.candidates[0].content.parts[0].text;\n\n        // Чистим JSON от лишних знаков\n        if (type === 'quiz') {\n            botText = botText.replace(/```json/g, '').replace(/```/g, '').trim();\n        }\n\n        return NextResponse.json({ text: botText });\n\n    } catch (error: any) {\n        console.error('Final error:', error);\n        return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,YAAY,EAAE,GAAG;QAE/B,sCAAsC;QACtC,MAAM,UAAU,QAAQ,GAAG,CAAC,iBAAiB;QAE7C,IAAI,CAAC,cAAc;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,IAAI,SAAS;QACb,IAAI,SAAS,WAAW;YACpB,SAAS,CAAC,yDAAyD,EAAE,cAAc;QACvF,OAAO;YACH,SAAS,CAAC;;kBAEJ,EAAE,cAAc;QAC1B;QAEA,qDAAqD;QACrD,MAAM,MAAM,CAAC,gGAAgG,EAAE,SAAS;QAExH,MAAM,WAAW,MAAM,MAAM,KAAK;YAC9B,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACjB,UAAU;oBAAC;wBAAE,OAAO;4BAAC;gCAAE,MAAM;4BAAO;yBAAE;oBAAC;iBAAE;YAC7C;QACJ;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAC7D;QAEA,IAAI,UAAU,KAAK,UAAU,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;QAEtD,+BAA+B;QAC/B,IAAI,SAAS,QAAQ;YACjB,UAAU,QAAQ,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;QACtE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAQ;IAE7C,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ"}}]
}